# 数据分析-拉勾教育

## 第一章 数据分析思维与业务流程

* 数据分析是立足于业务的基础上，通过数据<font color='red'>收集、清洗、处理、分析、建模、展示</font>等方式，用于监控业务状态。分析方案效果，定位业务问题，最终实现优化业务，辅助决策制定。

###数据分析流程

* 数据分析的流程
  * 需求分析
    * 问题定位
    * 需求拆解
  * 数据收集
    * Mysql数据查询
    * hive数据查询
    * 爬虫
  * 数据处理   ： <font color='red'>得到有价值的数据</font>
    * extract 提取
    * transform 转换
    * load 加载
  * 数据分析
    * 业务指标体系
    * 数据分析模型
    * 数据分析、统计方法
  * 数据可视化
    * tableau
    * 神策数据平台
    * quick bi
  * 数据分析报告
    * 明确的结论
    * 结构清晰，逻辑严谨
    * 图文结合



###明确&定位问题

* 明确问题方法论-- 5W2H
  * WHY WHAT WHO WHEN WHERE HOW     HOW MUCH![1596767847912](/Users/yibo/Documents/笔记/1596767847912.jpg)



* 定位问题原因方法论
  * ​		![1596768215048](/Users/yibo/Documents/笔记/1596768215048.jpg)





* 业务指标体系

  * 对业务有参考价值的统计数据
  * 当企业发展目标时，用指标来量化发展目标

     

###数据分析模型

####用户分析

* 用户结构分析
  * 自然属性：年龄、性别、地域
  * 社会属性：学历、家庭状况、婚姻、子女
  * 商业属性：财富等级、消费档次、信用
  * 心里属性：价格敏感性、偏好属性
  * 行为属性：浏览频次、浏览品类、浏览价格带、下单频次、下单品类价格
  * 价值属性：adr贡献

<font color='red'>有些属性是静态数据，不容易改变比如性别、婚姻。有些属性是动态数据，我们要重点收集动态数据，来制定更精准的策略。</font>



* 用户行为分析。

  * 通过用户行为日志，将每一个用户的行为找出来，对每一个用户行为，对用户指定标签，来对用户分类。

* 用户价值分析

  * 购买金额

  * 购买频次

  * 购买平均金额

  * 购买内容

  * 复购频次

  * 复购间隔

  * 复购内容

    ->用户的交易数据常被忽略

    ->行为+结果=心理

    ->不要单纯的吧用户交易数据当做普通数据。比如一个用户在第一次发生交易后，持续发生交易，那么不能简单被定义为普通用户，而被定义为忠实用户 

    

####用户生命周期模型

* 引入期
* 成长期
* 成熟期
* 休眠期
* 流失期



####AARRR用户增长模型

* 获取 Acquisition -- 通过渠道让用户找到我们
  * 口碑渠道 病毒营销
  * 有机渠道 搜索引擎优化，内容营销
  * 付费渠道 电视广告、赞助
    * 渠道曝光率
    * 渠道转换率
    * 日增用户数
    * 日应用下载量
    * 获客成本CAC：获取一个用户所消耗的成本
* 激活 Actication -- 用户的首次体验如何
  * DAU=当日新增+累计历史日留存
  * 活跃用户构成 （新老用户数，占比，活跃率）
  * 活跃率 某段时间，活跃用户在总用户的占比。 DAU日活跃率 WAU周活跃率 MAU月活跃率
  * 用户流失率
  * PV 页面浏览量
  * UV 一定时间内访问网页的人数。无论一个用户访问几次，都算一个访客。通过cookie和ip判断。
* 留存 Retention  -- 用户会回来么
  * 次日留存率 （当天新增的用户中，第二天使用过产品的用户数）/ 第一天新增的用户数
  * 第三日留存率
  * 第七日留存率
  * 第三十天留存率
    * 有效触达，唤醒用户
    * 搭建激励体系，留存用户
    * 丰富内容，增加在线时长
    * 数据反推，找到关键点   比如什么样的用户很难流失
* 收入 Revenue -- 如何赚到钱
  * 客单价 每个用户平均购买商品的金额
  * PUR 付费用户占比
  * 复购率 一定时间内，消费两次以上的用户/总购买用户数
* 推荐 Referral -- 用户会告诉其他人吗
  * 转发率   转发的用户数/看到该功能的用户数
  * 转化率  购买人数/看到该商品的人数
  * K因子 = 每个用户向他的朋友圈发出请求的数量 * 接收到邀请的人转化为新用户的转化率



####RFM模型  （用户分类）

* R值，最近一次消费
* F值，消费频率
* M值，消费金额
  * ![1596786249951](/Users/yibo/Documents/笔记/1596786249951.jpg)用来判断用户重要价值，需要重要保留的用户 还是需要重要挽留的用户
    * <font color='red'>通过具体的业务指标，进行区间设置打分，打分规则一般1-5分</font>





### 数据分析方法

#### 对比分析法

<<<<<<< HEAD
* 与目标对比

  实际完成值与目标值对比，横比

* 不同时期对比

  选择不同时期的指标数值，作为标准对比，环比，同比    纵比

* 同级别对比

  同级部门单位地区对比   横比

* 行业内对比

  对比找出自身发展方向 横比

* 活动效果对比

  营销活动前后效果对比   纵比

#####<font color='red'>横比纵比区别</font>

​	同时期：横比

​	不同时期： 纵比



=======
>>>>>>> 2d6f6efcd51408a121ebcbc20087ef9684ea4fca
#####时间对比

* 同比

  * 本期与去年同期水平对比

* 环比

  * 本期与上一统计周期水平对比

* 定基比

  * 本期与固定基期水平对比

  

#####空间对比

* 其他的团队的对比
* 表现优秀的团队的对比
* 行业标杆对比



#### 趋势分析法

* 计算趋势比率或指数
  * 根据指数计算结果，评价和判断企业各项指标的变动趋势及其合理性
* 预测发展趋势



#### 矩阵关联分析法

根据两个关键属性，进行分析，划分出四个区域  高高 高低 低高 低低 进行分类分析



#### 分组分析法

![1596788013384](/Users/yibo/Documents/笔记/1596788013384.jpg)

#### 漏斗分析法

![1596788056958](/Users/yibo/Documents/笔记/1596788056958.jpg)

####细分分析

* 拆组成
  * 根据分析对象的特征，按照一定标准拆分，将性质相同的对象合并在一起，保持组内对象的一致性，组与组之间的差异性。
* 拆步骤
  * 针对业务流程判断的一种分析方法，通过对某些关键指标路径的转化率分析，发现业务中的问题（漏斗图）
* 拆要素
  * 针对指标的构成要素向下分拆，拆到最末级要素时，就可以定位到末级指标对应的影响因素。从而能够做到指导具体的业务动作。





### 数据分析案例 （DAU异常）

#### 确保数据正确   

不是因为数据错误的问题导致看上去用户数量急剧下降

#### 确认数据是否异常

确定是否为周期变化

是否在可接受区间

#### 指标维度拆分

![1596788879304](/Users/yibo/Documents/笔记/1596788879304.jpg)

影响系数= (今日量-昨日量) / (今日总量-昨日总量)

#### 定位具体原因

* 内部因素
  * 渠道
  * 版本
  * 活动
* 外部因素
  * 政治
  * 经济
  * 社会
  * 技术

#### 提出解决方法

根据上一部分定位到的原因，提供解决方法。

<<<<<<< HEAD
###知识点

![1596789333417](/Users/yibo/Documents/笔记/1596789333417.jpg)





## 第二章 excel

### 基本功能

* 冻结首行
* 自动编号(12345)
* 输入是显示提示信息
  * 数据，数据验证，输入信息，里面输入信息提示

* 地址引用
  * 相对引用  -> 行和列都不锁
    * 写B2*0.8  （或者点击B2的位置）  往下拉公式（或右下角双击）
  * 绝对引用  -> 行和列都锁
    * 写B2*\$C\$2  将C2加锁 往下拉公式的时候，C2不会变成C3
  * 混合引用
    * 写\$B2*C\$1  不变的加$
* IF函数  if(\$B2>=C\$1,$B2*C\$1,"")    ->   if(test,true value,false value)
  * if(sum(a:a),'情况1', if(sum(a:a,'情况2','情况3')))
  * 在if中嵌套if
* 字符串相连  用 &   ->  F14 & "*" & G13 "=" IF...
* 单元格换行 shift+command+回车
* 选择 当前位置向上所有 shift+command+向上键
* 筛选-高级 筛选 去重 复制到别的区域
* sumif(从哪找,找什么,哪求和)
* sumifs(哪求和,从哪找1,找什么1,从哪找2,找什么2...)
* 条件格式 数据条能显示类似柱状图

* 列变行
  * 复制后，选粘贴选项，选择转置
* 平滑 
  * 选择线，设置数据系列格式，填充，平滑线
* 截取字符串
  * left(截取谁,从左侧截取几位)

* 找数量
  * count
  * countif(从哪找,找谁)
* 加锁
  * <font color='red'>拖拽时 范围加锁</font>
* 平均值
* average(范围)
* vlookup(找谁，<font color='red'>从哪里找+引用谁(输出谁)</font>，引用的列索引，是否精确查找0/1)    0是精确查找
* date(2019,1,1) 造日期







### 行业案例

####分析方法

* 哪类产品销售的好

  * 需求确认
    * 比啥 ： 销量 销售额？
    * 怎么比： 环比 同比 相同时间段
    * 给谁比： 各品类
  * 数据收集
    * 依据指标收集数据
  * 数据处理
    * 筛选
    * 计算
  * 数据分析
    * 对比
  * 展现结果
    * 表 格式条件 数据条
    * 图 柱状图等

* 趋势分析

  * 掌握大的方向
  * 趋势类型
    * 上升
    * 下降
    * 平稳
  * 多做纵向分析    -> 不同时间段的指标进行比较
    * 时期数据的走势
  * 比较的指标
    * 订单量、总量、销售额
  * 比较的时间颗粒度
    * 时
    * 天
    * 月
    * 年
  * 数据分析
    * 趋势
  * 展现结果
    * 折线图

* 矩阵关联法     象限分析法    -> <font color='red'>两个指标</font>

  * 就是散点图，然后设置坐标轴格式(坐标轴位置)

    ![1597048730412](/Users/yibo/Desktop/数据分析/1597048730412.jpg)

    * <font color='red'>对于34象限的渠道投放都不精准，这部分渠道可以少投些，主要投放12象限的渠道</font>

    ![1597048963825](/Users/yibo/Desktop/数据分析/1597048963825.jpg)

    ![1597049095981](/Users/yibo/Desktop/数据分析/1597049095981.jpg)

    ![1597049425205](/Users/yibo/Desktop/数据分析/1597049425205.jpg)

    ​	

#### 矩阵关联法（案例）

#####需求确认

​	通过总销售额和平均利润来反应水果的销售情况

##### 数据收集

​	收集数据的时候，应收集跟销售额、利润相关的数据 -> 可以算出销售额和利润的数据 -> <font color='red'>依据指标和计算口径获取数据</font>

##### 数据处理

​	计算平均利润   ->  总利润 / 总销售量

​	统计销售额

​	xy轴的位置为2两个属性（销售额、平均利润）的平均值

#####数据展示

​	绘制散点图

​	然后删掉标签

​	删除网格线

​	然后添加坐标轴标题 （平均利润  销售额）

​	选择点 添加数据标签

​	设置数据标签格式  选单元格中的值，选中产品品类

​	勾选掉Y值（去掉数字值）

##### 数据分析

​	芒果利润低 销售额低 下架

#####小结（矩阵关联）

######使用时机

两个指标线性无关且放在一起有意义就可以用矩阵关联

######线性无关

一个指标随另一个指标升高时降低，或随另一个指标升高时升高。



#### 分组分析（案例）

* 定义
  
  * 分组分析法是根据数据分析对象的特征，按照一定的指标，把数据分析对象分为<font color='red'>不同的部分和类型</font>来进行比较研究
* 目的
  
  * 把总体中具有不同性质的对象区分开，把性质相同的对象合并在一起对比。分组分析一般用对比分析。
* 概念
  * 组数
  * 上限
  * 下限
  * 组距
  * 组中值 -> 上下限平均值
  * 开口组 -> 第一或最后一个组含以下以上的组
  * 重叠组 -> 相邻组
* <font color='red'>实际上就是把数据按照一定规则分组对比，上限不含（上限分在另一个组里当下限）</font>

* 需求确认

  * 确认分组依据

  

#### 漏斗分析（案例）

* 定义
  * 一套流程式分析，科学反映用户行为状态从起点到终点各阶段的用户转化率情况。
* 适用范围
  * 业务流程相对规范、周期较长、环节较多的流程分析。能够直观的发现和说明问题
* 基于
  * 用户
    * 针对用户结果
  * 事件    ->从什么事件到什么事件，用户量变化
    * 针对产品本身
* 确认需求
  * 找到关键的节点
* 数据收集
  * 根据节点的计算公式 收集数据



#### RFM模型（案例）

* RFM客户价值模型
  * R（recency）
    * 上一次购买距今天/窗口结束的天/月数
    * 上次消费时间越近，对提供即时的商品或者服务也<font color='red'>最有可能反应</font>
  * F（frequency）
    * 顾客在限定事件内所购买的次数
    * 经常购买的顾客，也是满意度最高的顾客，用来刻画<font color='red'>忠诚度</font>
  * M（monetary）
    * 客户在限定时间内所消费的金额
    * 客户的消费能力
* 需求确认
  * 用户划分几类，时间窗口期，R的单位是日/月
  * R确定几个阶段、F确定几个阶段、M确定几个阶段
* R值
  * 使用maxifs(从哪取值，从哪找，找谁) 来获得最近购买日期
  * 在用date(2020,8,14) 今天日期 - 最近购买日期 得到 购买天数
  * 将天数转化为数值
* F值
  * countif 来统计购买次数
* M值
  * sumif 来统计购买总金额
* 划分组
  * 比如按均值 分成两组
  * if(某项>$平均值，"True"，"False")
* 使用对用表，将客户类型 与 RFM高低值对应
  * 使用vlookup匹配

![1597223318269](/Users/yibo/Desktop/数据分析/1597223318269.jpg)





### KPI指标涨跌异动分析（原因定位分析）

#### 问题拆解

* 假设驱动

  * 把问题的锚点定在某一个细分点上面
    * 对问题没有头绪的时候

* 搭建问题树

  * 确认是否为真的问题

    * 是否有促销活动
    * 是否以往有波动，是否在正常的波动范围
      * 使用环比来确认是否在正常的波动范围 （往前几个月 找波动范围）

  * 把问题拆解为若干小问题

    * 确定核心问题和起始问题
      * 利润下跌
    * 问题原因
      * 利润下跌与产品和渠道有关。由于渠道少，所以对渠道进行矩阵关联法，找销量高，利润低的。发现免费渠道是销售额高，利润低的。
      * 在免费渠道里，在对店家进行矩阵关联，发现某店家是销量高，利润低的，在看具体数据。
    * 问题后果
    * 依据因果关系画出问题树

    >利润下跌
    >
    >> 产品
    >>
    >> 渠道类型
    >>
    >> > 渠道名称
    >> >
    >> > > 销售量
    >> > >
    >> > > 利润





### 渠道排名 （综合分析案例）  -> 目标优化矩阵表

* 指标确认
  * 渠道的数量指标（访问数，页面浏览数）
  * 渠道的质量指标（ROI，到达率，页面停留时间，浏览深度，用户访问频数）

* 需求确认

  * 确认要考察的指标及计算口径    ->  <font color='red'>要确认指标权重</font>

    * <font color='red'>目标优化矩阵表</font>

      * 简单。方便。快捷

      * > 1. 将所有指标，横轴纵轴展开
        > 2. 如果纵轴指标比横轴指标重要，在交叉处填1 否则填0
        > 3. 计算每行结果，为该纵轴每指标的得分
        > 4. 如果某指标重要性合计为0 则可以把每个指标 +1 再算权重  
        > 5. 计算权重  改指标得分/总分

    * 主成分分析



####数据标准化

* 0-1标准化 （最大值最小值标准化）
  * 把所有指标压缩到0-1   <font color='red'>消除量纲的影响</font>
* z标准化
  * 零-均值规范化也称标准差标准化，经过处理的数据的均值为0，标准差为1。转化公式为：
  * ![img](http://latex.codecogs.com/gif.latex?x%5E%7B*%7D%20%3D%20%5Cfrac%7Bx-%5Cbar%7Bx%7D%7D%7B%5Csigma%20%7D)
  * 其中![img](http://latex.codecogs.com/gif.latex?%5Cbar%7Bx%7D)为原始数据的均值，![img](http://latex.codecogs.com/gif.latex?%5Csigma)为原始数据的标准差，是当前用得最多的数据标准化方式。标准差分数可以回答这样一个问题："给定数据距离其均值多少个标准差"的问题，在均值之上的数据会得到一个正的标准化分数，反之会得到一个负的标准化分数。



####计算综合得分

​	将个品类的各指标值*各指标的权重求和。得到排名。

* 计算的时候可以使用 MMULT(一行N列的指标值，N行一列的指标系数) 矩阵相乘











### 指标体系模型搭建（自动化办公）

* 制表，确认指标体系  -> 和业务人员反复确认
  * 数据验证，序列   输入变成下拉菜单
* 建立个指标的指标口径  -> 和业务人员反复确认
* 建立结果表
  * 使用vlookup 找到输入的下拉菜单值，匹配指标口径，将值填入结果表

* if的使用
  * if(sum(a:a),'情况1', if(sum(a:a,'情况2','情况3')))
  * 在if中嵌套if







### 统计函数总结及扩展

#### 求和类函数

- sum 普通求和
- sumif 单个条件求和
- sumifs 多个条件求和

#### 统计类函数

- count 单元格内容为数值的单元格个数
- counta 非空单元格个数
- countblank 空单元格个数
- countif 单个条件 满足条件的    countif(E:E,"<1000")
- countifs 多个条件 满足条件的    countifs(E:E,"\<1000",F:F,">1000")

#### 统计函数

- average(数据范围)
- averageif(从哪找,找谁,哪求平均)
- averageifs(求平均范围,从哪找,找谁,从哪找,找谁)

#### 查找引用函数

- vlookup(找谁，<font color='red'>从哪里找+引用谁（输出谁）</font>，引用的列索引，是否精确查找0/1)    0是精确查找

  - vlookup(\$H6,\$A:\$C,COLUMN(B1),0)

    - 找H6 从A到C列中找，<font color='red'>返回的是B列的值 column(b1) 也可以写成2 代表返回第二列的值</font> 精确查找

    * VLOOKUP 第 4 个参数<font color='red'>关于第 4 个参数，官方的描述是这样的：**当该参数为 TRUE 或省略，并查找区间找不到查找值，则匹配小于查找值的最大值**，图解如下。</font>



#### 通配符

countif 和 sumif 只比较前15位，若15位之后还有数据，需要告诉excel还需要继续比较

使用通配符countif(A:A,F15 & "*")   <font color='red'>在条件上连接 & "\*" </font>



#### 限制条件录入

##### 不允许重复输入

数据验证，自定义，=countif(\$A:\$A,\$A1)<2

##### 不许大于总数

数据验证，自定义，=sumif(库存那边从哪找，库存那边找那个，库存那边哪求和)>=sumif(出库那边从哪找，出库那边找那个，出库那边哪求和)





###查找及日期函数扩展

####日期函数

* DATEDIF(开始日期，结束日期，'计算单位 Y/M/D')    计算两单位日期差
* NETWORKDAYS(开始日期，结束日期，节假日范围)  返回开始日期和结束日期之间的所有工作日数
* TODAY() 当前日期
* NOW()  当前时间
* WEEKDAY(日期，星期计算方式)  返回周几
* WEEKNUM(日期，星期计算方式) 返回一年中第几周
* YEAR/MONTH/DAY/HOUR/MINUTE/SECOUD(日期)  返回指定日期的年/月/日/时/分/秒
* DATE(YEAR,MONTH,DAY) 制作日期
* TIME(HOUR,MINUTE,SECOND)   制作时间
* 获得下月第一天 -1 就得到了 当月最后一天

####查找函数

* vlookup(找谁，从哪找，输出第几列的，怎么找)

  * <font color='red'>查找的内容，必须在从哪找的第一列</font>
  * <font color='red'>从哪找里比如包括输出的列</font>
  * VLOOKUP 第 4 个参数<font color='red'>关于第 4 个参数，官方的描述是这样的：**当该参数为 TRUE 或省略，并查找区间找不到查找值，则匹配小于查找值的最大值**，图解如下。</font>

  

* match(找谁，从哪找，怎么找)

  * 返回位置

* index(范围，行，列)

* offset(相对位置，下移行数，右移列数，行数，列数)

  * 输入引用的范围
  * <font color='red'>一般用于动态图表，动态选择数据范围</font>



### 字符串函数及扩展

#### 截取

* left(字符串，截几个) 从左
  * LEFT(B2,FINE(B2,'-')-1)

* right

#### 查找

* mid(字符串，开始位置，长度) 
  * 从字符串制定位置开始截取指定长度
* find(找什么，从哪个字符串找，) 在指定字符串中的指定位置开始找，返回第一次出现的位置。
  * mid(b2 , FIND('-',B2)+1  ,FIND('-'.B2,FIND('-',B2)+1))
    * 截取B2 （原始字符串）
    *  FIND('-',B2)+1  从b2的第一个"-"的后面一位开始截取
    * FIND('-' , B2, FIND('-',B2)+1) - FIND('-', B2) - 1 从第一个"-"后面开始找'-' 找到位置为8 <font color='red'>（从字符串开头算位置）</font> 减去 第一个'-'的位置 再减去第一个'-' 为第一个'-'与第二个'-'之间的长度
* len(字符串) 求字符串中字符的个数
* lenb(字符串) 求字符串存储所占的位数
* substitute(要处理的字符串，要替换掉的字符串，新字符串，[替换第几个])  <font color='red'>字符串替换</font>
* rept(字符串，重复几次)    把字符串 重复几次





### 高级筛选

* 或者关系
  * 高级筛选  条件区域，将筛选条件写到不同行（对角线），左上对应选择的列表区域的其中一列，右下对应选择的另一列。

* 通配符
  * * 任意多个任意字符
    * ？代表一个任意字符
    * ~放到*或?前，去掉通配符作用
* 字段名要求
  * 对原有字段进行筛选，字段名一定要正确一致
  * 对新字段进行筛选，可以没有字段名，可以新定义，但是不能与原字段重名





### 图表应用总结

* 环形图
  * 用于占比的可视化，只考虑占比，不要求数据精细情况
* 条形图
  * 对比项多时，条形图优于柱状图
* 散点图
  * 分析两组数据是否有关系
* 面积图
  * 和折线图一样表达总体趋势
  * 更强调数值随时间变化的程度
* 雷达图
  * 数据的多维对比
* 矩形树图
  * 展现占比，结构关系，层级关系
* 箱线图
  * 查看异常值
* 组合图
  * Y轴的两个维度，但差异较大，所以使用两个量级的坐标轴
    * 比如销量和销售额
* 地图
* 迷你图
  * 在单元格内，展现趋势，直观小巧





###数据透视表 & 数据看板

#### 数据透视表 （类似BI生成柱状图一样，生成表格）

交互式强大数据分析和汇总工具

* 不能有空字段名
* 不能有相同字段名
* 字段名不能有合并单元格



> ​	插入数据透视表
>
> ​	在区域吧数据源全选上，加锁
>
> ​	右键数据透视表，选择数据透视表选项
>
> ​	选择数据源
>
> * 筛选
>   * 控制汇总内容
> * 列
>   * 列维度字段
> * 行
>   * 行维度字段
> * 值
>   * 汇总统计方式

#### 计算字段

计算字段是有数据源生成的列与列计算得到的新列

####计算项

计算项是由数据透视表的列创建的列与列的计算得到的新列



#### 数据透视表的更新

* 重新手动选择数据源
* 将数据源转换成表，然后在表中加数据，在数据透视表中刷新





#### 切片器

利用哪一个字段 对数据透视表进行筛选

<font color='red'>创建切片器，然后报表连接，连接谁，联动谁</font>





#### 日程

用哪一个日期 对数据透视表进行筛选





